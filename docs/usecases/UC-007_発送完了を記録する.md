# UC-007: 発送完了を記録する

## 基本情報

| 項目 | 内容 |
|-----|------|
| ユースケースID | UC-007 |
| ユースケース名 | 発送完了を記録する |
| アクター | 作家 |
| 優先度 | 高 |
| ステータス | 未実装 |

## 概要

伝票を発行し、実際に発送が完了した注文のステータスを「発送済み」に更新する。

## 事前条件

- 作家がシステムにログインしていること
- 対象の注文が「発送前」または「伝票発行済み」ステータスであること

## 事後条件

- 注文ステータスが「発送済み」に更新されている
- 発送日時が記録されている
- （オプション）発送通知がプラットフォームに送信されている

## 基本フロー

1. 作家は発送前注文一覧（UC-003）または伝票発行後の画面から「発送完了」ボタンをクリックする
2. システムは確認ダイアログを表示する
3. 作家は発送完了を確認する
4. システムは以下を更新する：
   - 注文ステータスを「発送済み」に変更
   - 発送日時を現在日時で記録
   - 使用した配送方法を記録（クリックポスト / 宅急便コンパクト）
5. システムは完了メッセージを表示する
6. システムは発送前注文一覧を更新する

## 代替フロー

### 3a. 発送をキャンセルする場合
1. 作家は「キャンセル」をクリックする
2. ステータスは変更されない

### 5a. プラットフォームに発送通知を送信する場合
1. 作家は「プラットフォームに通知」オプションを有効にする
2. システムはminne/creemaのAPIまたはPlaywright経由で発送通知を送信する
3. 通知成功の確認を表示する

### 5b. 追跡番号を入力する場合
1. 作家は追跡番号入力欄に番号を入力する
2. システムは追跡番号を注文情報に記録する

## ビジネスルール

- BR-001: 発送完了後のステータス変更は管理者のみ可能
- BR-002: 発送日時は変更不可
- BR-003: 追跡番号は任意入力

## 非機能要件

- ステータス更新は1秒以内に完了する

## 画面・UI

### 発送完了確認ダイアログ

```
┌─────────────────────────────────────────────────────┐
│ ✅ 発送完了確認                                      │
├─────────────────────────────────────────────────────┤
│                                                     │
│  以下の注文を発送済みにしますか？                     │
│                                                     │
│  注文番号: ORD-2024-001234                          │
│  購入者: 山田 太郎 様                               │
│  購入品: ハンドメイドアクセサリー                    │
│  配送方法: クリックポスト                            │
│                                                     │
│  ─────────────────────────────────────────────────  │
│                                                     │
│  追跡番号（任意）: [____________________]           │
│                                                     │
│  □ minne/creemaに発送通知を送信する                 │
│                                                     │
│  ─────────────────────────────────────────────────  │
│                                                     │
│  [キャンセル]                      [発送完了にする]  │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 完了メッセージ

```
┌─────────────────────────────────────────────────────┐
│ 🎉 発送完了                                          │
├─────────────────────────────────────────────────────┤
│                                                     │
│  注文 ORD-2024-001234 を発送済みにしました。         │
│                                                     │
│  発送日時: 2024/01/15 15:30                         │
│  配送方法: クリックポスト                            │
│  追跡番号: 1234-5678-9012-3456                      │
│                                                     │
│  ✅ プラットフォームへの通知も完了しました。          │
│                                                     │
│                                        [閉じる]      │
│                                                     │
└─────────────────────────────────────────────────────┘
```

## データ

### 入力データ
- 対象注文ID
- 追跡番号（任意）
- プラットフォーム通知フラグ

### 出力データ（スプレッドシート更新）
- ステータス: 「発送済み」
- shipped_at: 発送日時
- shipping_method: 配送方法
- tracking_number: 追跡番号（入力した場合）

## 関連ユースケース

- UC-003: 発送前注文一覧を表示する（先行ユースケース）
- UC-004: クリックポスト伝票を発行する（先行ユースケース）
- UC-005: 宅急便コンパクト伝票を発行する（先行ユースケース）

## 備考

- 一括発送完了機能も将来的に検討
- 発送完了メールの自動送信機能も検討
- 追跡番号からの配送状況確認機能も将来的に検討
