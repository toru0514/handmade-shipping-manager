# UC-009: 発送お礼メッセージを作成する

## 基本情報

| 項目 | 内容 |
|-----|------|
| ユースケースID | UC-009 |
| ユースケース名 | 発送お礼メッセージを作成する |
| アクター | 作家 |
| 優先度 | 高 |
| ステータス | 未実装 |

## 概要

発送完了時に、購入者へ送る発送お礼メッセージを定型文ベースで自動生成し、コピーしやすい形で表示する。

## 事前条件

- 注文がスプレッドシートに登録されていること
- 発送方法が決定していること（クリックポスト or 宅急便コンパクト）
- 発送お礼の定型文が設定されていること

## 事後条件

- 発送お礼メッセージが生成され、画面に表示されている
- メッセージがクリップボードにコピー可能な状態になっている

## 基本フロー

1. 作家は発送完了記録（UC-006）の完了後、「発送お礼メッセージ」ボタンをクリックする
2. システムは注文情報と発送情報を取得する
3. システムは以下の情報を定型文に埋め込む：
   - 購入者名
   - 発送方法（クリックポスト / 宅急便コンパクト）
   - （オプション）追跡番号
   - （オプション）到着予定日
4. システムは生成されたメッセージをダイアログで表示する
5. 作家は「コピー」ボタンをクリックする
6. システムはメッセージをクリップボードにコピーする
7. 作家はminne/creemaのメッセージ機能に貼り付けて送信する

## 代替フロー

### 1a. 発送完了時に自動表示する場合
1. UC-006完了後、システムは自動的に発送お礼メッセージダイアログを表示する
2. 基本フロー4へ続く

### 4a. メッセージを編集する場合
1. 作家は生成されたメッセージを編集できる
2. 編集後、「コピー」ボタンをクリックする

## ビジネスルール

- BR-001: 定型文は設定画面で編集可能
- BR-002: 発送方法ごとに異なる定型文を設定可能
- BR-003: 追跡番号がある場合は自動的に追加

## 非機能要件

- メッセージ生成は即時（1秒以内）
- クリップボードコピーは確実に動作すること

## 画面・UI

### 発送お礼メッセージダイアログ

```
┌─────────────────────────────────────────────────────────────────┐
│ 📦 発送お礼メッセージ                                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  注文: ORD-2024-001234 (minne)                                  │
│  購入者: 山田 太郎 様                                           │
│  発送方法: クリックポスト                                        │
│  追跡番号: 1234-5678-9012-3456                                  │
│                                                                 │
│  ─────────────────────────────────────────────────────────────  │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 山田 太郎 様                                             │   │
│  │                                                         │   │
│  │ お待たせいたしました。                                   │   │
│  │ 本日、クリックポストにて発送いたしました。                │   │
│  │                                                         │   │
│  │ 追跡番号: 1234-5678-9012-3456                           │   │
│  │ 追跡URL: https://trackings.post.japanpost.jp/...         │   │
│  │                                                         │   │
│  │ 到着まで2〜3日程度かかる場合がございます。                │   │
│  │ 届きましたら、ご確認をお願いいたします。                  │   │
│  │                                                         │   │
│  │ この度はご購入いただき、ありがとうございました。          │   │
│  │ またのご利用を心よりお待ちしております。                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [編集する]                          [コピー 📋]  [閉じる]       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 発送完了後の表示

```
┌─────────────────────────────────────────────────────────────────┐
│ 🎉 発送完了                                                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  注文 ORD-2024-001234 を発送済みにしました。                     │
│                                                                 │
│  発送日時: 2024/01/15 15:30                                     │
│  配送方法: クリックポスト                                        │
│  追跡番号: 1234-5678-9012-3456                                  │
│                                                                 │
│  ─────────────────────────────────────────────────────────────  │
│                                                                 │
│  [発送お礼メッセージをコピー 📋]                 [閉じる]        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 定型文テンプレート

### クリックポスト用デフォルトテンプレート

```
{{buyer_name}} 様

お待たせいたしました。
本日、クリックポストにて発送いたしました。

{{#if tracking_number}}
追跡番号: {{tracking_number}}
追跡URL: https://trackings.post.japanpost.jp/services/srv/search/?requestNo1={{tracking_number}}
{{/if}}

到着まで2〜3日程度かかる場合がございます。
届きましたら、ご確認をお願いいたします。

この度はご購入いただき、ありがとうございました。
またのご利用を心よりお待ちしております。
```

### 宅急便コンパクト用デフォルトテンプレート

```
{{buyer_name}} 様

お待たせいたしました。
本日、宅急便コンパクトにて発送いたしました。

{{#if tracking_number}}
追跡番号: {{tracking_number}}
追跡URL: https://toi.kuronekoyamato.co.jp/cgi-bin/tneko?number={{tracking_number}}
{{/if}}

届きましたら、ご確認をお願いいたします。

この度はご購入いただき、ありがとうございました。
またのご利用を心よりお待ちしております。
```

### 利用可能な変数

| 変数 | 説明 | 例 |
|-----|------|-----|
| `{{buyer_name}}` | 購入者名 | 山田 太郎 |
| `{{shipping_method}}` | 発送方法 | クリックポスト |
| `{{tracking_number}}` | 追跡番号 | 1234-5678-9012-3456 |
| `{{shipped_at}}` | 発送日時 | 2024/01/15 |
| `{{product_name}}` | 商品名 | ハンドメイドアクセサリー |

## データ

### 入力データ
- 注文情報
- 発送情報（発送方法、追跡番号）
- 定型文テンプレート

### 出力データ
- 生成されたお礼メッセージ（テキスト）

## 関連ユースケース

- UC-006: 発送完了を記録する（発送完了後に実行）
- UC-004: クリックポスト伝票を発行する（追跡番号取得元）
- UC-005: 宅急便コンパクト伝票を発行する（追跡番号取得元）

## 備考

- 追跡URLは発送方法に応じて自動生成
- 将来的にはAIによるパーソナライズメッセージ生成も検討
- メッセージ送信履歴の記録も将来的に検討
- プラットフォームのAPI対応があれば自動送信も検討
